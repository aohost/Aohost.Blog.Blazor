@page "/tag/{name}"

@if (posts == null)
{
    <Loading></Loading>
}
else
{
    <div class="container">
        <div class="post-warp tags">
            @if (!string.IsNullOrEmpty(tagName))
            {
                <h2 class="post-title">-&nbsp;Tag_&nbsp;@tagName&nbsp;-</h2>
            }
        </div>
        <div class="post-warp archive">
            @if(posts.Success && posts.Result.Any())
            {
                @foreach(var item in posts.Result)
                {
                    <h3>@item.Year</h3>
                    @foreach(var post in item.Posts)
                    {
                        <article class="archive-item">
                            <NavLink href="@("/post"+post.Url)">@post.Title</NavLink>
                            <span class="archive-item-date">@post.CreationTime</span>
                        </article>
                    }
                }
            }
            else
            {
                <ErrorTip></ErrorTip>
            }
        </div>
    </div>
}


@code{
    /// <summary>
    /// 标签名称参数
    /// </summary>
    [Parameter]
    public string name { get; set; }

    /// <summary>
    /// 标签名称
    /// </summary>
    private string tagName { get; set; }

    /// <summary>
    /// 文章详情列表
    /// </summary>
    private ServiceResult<IEnumerable<QueryPostDto>> posts;

    protected override async Task OnInitializedAsync()
    {
        var tag = await Http.GetFromJsonAsync<ServiceResult<string>>($"/blog/tag?name={name}");

        posts = await Http.GetFromJsonAsync<ServiceResult<IEnumerable<QueryPostDto>>>($"/blog/posts/tag?name={name}");
        if (tag.Success)
        {
            tagName = tag.Result;
        }
    }
}